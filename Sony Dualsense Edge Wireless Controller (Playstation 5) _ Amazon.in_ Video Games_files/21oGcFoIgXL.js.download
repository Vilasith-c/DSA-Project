(function(f){var l=window.AmazonUIPageJS||window.P,m=l._namespace||l.attributeErrors,b=m?m("NileInlineCustomerExperienceWidgetDPXAssets",""):l;b.guardFatal?b.guardFatal(f)(b,window):b.execute(function(){f(b,window)})})(function(f,l,m){f.now("nile-inline-state-utils").execute(function(b){b||f.when("A","dp-latency-marker").register("nile-inline-state-utils",function(b){return{getState:function(p){var f=b.state(p);if(f)return f;b.state.parse();return b.state(p)}}})});f.now("nile-inline-widget-instrumentation").execute(function(b){b||
f.when("nile-inline-state-utils","dp-latency-marker").register("nile-inline-widget-instrumentation",function(b){function f(a){var c=Array.from(arguments).slice(1,arguments.length);return function(){for(var d=arguments.length,e=Array(d),h=0;h<d;h++)e[h]=arguments[h];a.apply(void 0,c.concat(e))}}function q(a){a=[a.dataset.blueMetrics,a.dataset.actionId];a=a.filter(function(a){return a!==m&&null!==a&&""!==a});return a.join(":")}function g(a){for(var c=Object.keys(a),d=0;d<c.length;d++){var e=c[d],h=
a[e];null===h||h===m?h="":"number"===typeof h&&(h=h.toString());a[e]=h}return a}function n(a,c){var d=(d=document.cookie.match(/(?:^|;)\s*amzn-app-id\s*=\s*([^\s;]+)/))?d[1].split("/"):[];var e=/(?:^|;)\s*micron\s*=\s*1\s*(?:$|;)/.test(document.cookie);d={name:d[0],version:d[1],isMicron:e};e=document.cookie.match(/(?:^|;)\s*amzn-app-ctxt\s*=\s*\d\.\d?\s*([^\s;]+)/);try{var h=e?JSON.parse(decodeURIComponent(e[1])):""}catch(D){h=""}e=b.getState("dpx-nice-state");a=Object.assign({timestamp:k(new Date),
producerId:"mshop-nile",metadata:'{"program":"blue-dpx"}',isBeta:!1,deviceTypeId:h&&h.di&&h.di.dti||"",directedCustomerId:e&&e.directedCustomerId||"",appVersion:d&&d.version||"",locale:e&&e.locale||"UNKNOWN",marketplaceId:e&&e.marketplaceId||"UNKNOWN",uxSessionId:"",sessionId:v()||""},a);"undefined"!==typeof ue&&ue.event(g(a),"mshop-nile",c)}function w(a,c){var d=a.luggage,e=d.items[a.key];if(c=c[0])c.isIntersecting?(e.impressingStartAt=new Date,d.visibleElems.add(e.key)):e.impressingStartAt&&(e.impressingEndAt=
new Date,e.reason=null!=c.rootBounds?"SCROLLED_AWAY":"REMOVED",t(a),e.impressingStartAt=null,e.impressingEndAt=null,d.visibleElems.remove(e.key))}function l(a){var c=a.luggage.items[a.key];c.impressingStartAt&&"visible"!==document.visibilityState&&(document.contains(c.elem)&&(c.impressingEndAt=new Date,c.reason="PAGE_HIDDEN",t(a)),document.removeEventListener("visibilitychange",c.pageVisibilityChangeListener))}function x(a,c){a.chunks.addFromEvent(c)}function r(a,c,d){a.requestEndAt=new Date;c=a.chunks.markAsRendered(c);
if(d&&d[0]){var e=d[0].matches("[data-blue-request-id]")&&d[0]||d[0].querySelector("[data-blue-request-id]");if(e)for(a.requestId=e.dataset.blueRequestId,n({schemaId:"mshop.nile.events.4",eventTimeUTC:k(a.requestStartAt),nileRequestId:a.requestId,clickstreamRequestId:null,eventName:"INVOKE_NILE_BACKEND_API",eventDetail:void 0},"mshop.nile.events.4"),d=d.find("[data-blue-metrics]"),e=f(y,a),a.visibilityChangeListenerForLatency=e,document.addEventListener("visibilitychange",a.visibilityChangeListenerForLatency),
e=0;e<d.length;e++){var h=d[e],b=q(h);if(a.items[b])a.items[b].elem=h;else{a.items[b]={key:b,elem:h,name:h.dataset.blueMetrics,detail:h.dataset.actionId};var g=c;n({schemaId:"mshop.nile.latency.6",nileRequestId:a.requestId,elementId:h.dataset.actionId,seqId:g.index,requestStartTimeUTC:k(a.requestStartAt),renderingStartTimeUTC:k(g.renderingStartAt),renderingEndTimeUTC:k(g.renderingEndAt),interruptedTimeUTC:""},"mshop.nile.latency.6")}b=h={luggage:a,key:b};g=b.luggage.items[b.key];g.elem.observer||
(g.elem.observer=new IntersectionObserver(f(w,b),{threshold:.85}),g.elem.observer.observe(g.ghost||g.elem),g.pageVisibilityChangeListener||(g.pageVisibilityChangeListener=f(l,b),document.addEventListener("visibilitychange",g.pageVisibilityChangeListener)));b=h.luggage.items[h.key];b.elem.clickListener||(b.elem.clickListener=f(z,h),b.elem.addEventListener("click",b.elem.clickListener))}}}function A(a,c){a.requestEndAt=new Date;document.removeEventListener("visibilitychange",a.visibilityChangeListenerForLatency)}
function y(a){if("visible"!==document.visibilityState&&!a.requestEndAt){a.interruptedAt=new Date;var c=a.flow.toUpperCase(),d=a.chunks.maybeGetLastRendered();n({schemaId:"mshop.nile.latency.6",nileRequestId:a.requestId,elementId:c,seqId:d?d.index+1:0,requestStartTimeUTC:k(a.requestStartAt),renderingStartTimeUTC:"",renderingEndTimeUTC:"",interruptedTimeUTC:k(a.interruptedAt)},"mshop.nile.latency.6");Object.keys(a.items)}}function t(a){var c=a.luggage;a=c.items[a.key];n({schemaId:"mshop.nile.impressions.1",
nileRequestId:c.requestId,elementId:a.detail||a.name,seqId:a.chunkId||0,requestStartTimeUTC:k(c.requestStartAt),impressionStartTimeUTC:k(a.impressingStartAt),impressionEndTimeUTC:k(a.impressingEndAt),impressionEndReason:a.reason},"mshop.nile.impressions.1")}function z(a){var c=a.luggage.items[a.key];n({schemaId:"mshop.nile.events.4",eventTimeUTC:k(new Date),nileRequestId:a.luggage.requestId,clickstreamRequestId:null,eventName:c.name,eventDetail:c.detail},"mshop.nile.events.4")}function k(a){return a instanceof
Date?a.toISOString():""}function B(a){a=(a=(a=a&&a.event&&a.event.refTarget)&&a.closest("[data-blue-metrics]"))&&a.dataset&&a.dataset.actionId;return/^[a-z][a-z0-9]*(?:_[a-z0-9]+)*_\d_\d+$/.test(a)?a:m}function C(a){return{flow:a.flow,actionId:B(a),chunks:{length:0,addFromEvent:function(a){var c={event:a,renderingStartAt:new Date,index:this.length};a.index=c.index;return[].push.call(this,c)},getFromEvent:function(a){return this[a.index]},maybeGetLastRendered:function(){for(var a=this.length,d=0;d<
a&&this[d].renderingEndAt;d++);return 0===d?null:this[d-1]},markAsRendered:function(a){a=this.getFromEvent(a);a.renderingEndAt=new Date;return a}},requestStartAt:new Date,requestEndAt:null,answer:{},visibleElems:{length:0,add:function(a){this[a]||[].push.call(this,a)},remove:function(a){delete this[a]}},items:{}}}function v(){var a=document.cookie.match(/(?:^|;)\s*session-id\s*=\s*([^\s;]+)/);return a?a[1]:""}var u={};return{executeAndLogMetrics:function(a,c){c=C(c);var d=u.luggage;d&&(document.removeEventListener("visibilitychange",
d.visibilityChangeListenerForLatency),d.answer&&d.answer.observer&&(d.answer.observer.unobserve(d.answer.elem),document.removeEventListener("visibilitychange",d.answer.visibilityChangeListener)));u.luggage=c;c={afterFullRender:f(A,c),beforePillRender:f(x,c),afterPillRender:f(r,c)};a(c)},buildContext:function(a,c){return{flow:a,event:c}}}})});f.when("A").execute(function(b){function r(b,f){var g,n=new Promise(function(b){g=setTimeout(function(){b("timeout")},f)});b=b();return Promise.race([b,n]).then(function(b){clearTimeout(g);
return b})}function p(){return new Promise(function(g){f.when("rufus-eligible").execute(function(){b.declarative("dpx-rufus-connect","click",function(b){b.$currentTarget.find(".ask-pill").length?l.P.now("rufus-handle-expand").execute(function(b){b&&b("NileRelatedQuestionIngress")}):l.P.when("rufus-handle-stream").execute(function(g){g&&(ue&&ue.count&&ue.count("RUFUS_DPX_ATF_PILL_CLICK_SENT_TO_RUFUS_DESKTOP",1),g({qis:"What do customers say?"===b.data.query?"NileNDSWDCSRelatedQuestion":"NileRelatedQuestionIngress",
query:b.data.query,metricName:"BlueDPXIngress"}))})});g("resolved")})})}function q(){r(p,50).then(function(g){"timeout"===g&&f.now("rufus-eligible").execute("hide-dpx-widget",function(g){g===m&&b.$("#dpx-nice-widget-container").hide(0)})}).catch(function(g){b.$("#dpx-nice-widget-container").hide(0)})}q();b.on("PageRefresh:ATF",q)});f.when("A","nile-inline-widget-instrumentation").execute(function(b,f){(function(){var l=f.buildContext("pills");f.executeAndLogMetrics(function(f){var g={type:"default_pills"};
f.beforePillRender(g);f.afterPillRender(g,b.$("#dpx-nice-widget-container"))},l)})()})});